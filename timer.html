<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<meta name="renderer" content="webkit">
		<title>RTH Toolbox</title>
		<link href="unpackage/res/icons/512x512.png" rel="apple-touch-icon">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left back"></a>
			<h1 class="mui-title"></h1>
		</header>
		<div class="win" style="display:none">
			<div style="right:80px" onclick="require('electron').remote.getCurrentWindow().minimize()">-</div>
			<div style="right:40px" onclick="maximize()">+</div>
			<div style="right:0px" onclick="window.close()">×</div>
		</div>
		<div class="mui-content">
			<div class="mui-input-row">
				<input id="Time" type="text" value="00:00:00" style="text-align:center" oninput="timeInput()" onkeydown="if(event.keyCode==13){start()}">
			</div>
			<div class="mui-input-row mui-input-range">
				<label id="HourLabel"></label>
				<input type="range" id="Hour" value="0" min="0" max="23" onchange="timeChanged()">
			</div>
			<div class="mui-input-row mui-input-range">
				<label id="MinuteLabel"></label>
				<input type="range" id="Minute" value="0" min="0" max="59" onchange="timeChanged()">
			</div>
			<div class="mui-input-row mui-input-range">
				<label id="SecondLabel"></label>
				<input type="range" id="Second" value="0" min="0" max="59" onchange="timeChanged()">
			</div>
			<select style="margin-top:15px"></select>
			<button id="StartButton" type="button" class="mui-btn mui-btn-blue mui-btn-block" onclick="start()"></button>
			<button id="PauseButton" type="button" class="mui-btn mui-btn-block" disabled="disabled" onclick="pause()"></button>
			<fieldset style="margin-top:20px">
				<legend id="TimedTask"></legend>
				<div class="mui-input-row mui-checkbox">
					<label id="CreateMessageBoxLabel"></label>
					<input id="CreateMessageBoxCheck" type="checkbox" checked="checked">
				</div>
				<div class="mui-input-row">
					<input id="CreateMessageBoxInput" type="text" class="mui-input-clear">
				</div>
				<div class="mui-input-row mui-checkbox">
					<label id="OpenWebPageLabel"></label>
					<input id="OpenWebPageCheck" type="checkbox">
				</div>
				<div class="mui-input-row">
					<input id="OpenWebPageInput" type="text" class="mui-input-clear">
				</div>
				<div id="SpeakDiv1" class="mui-input-row mui-checkbox">
					<label id="SpeakLabel"></label>
					<input id="SpeakCheck" type="checkbox" checked="checked">
				</div>
				<div id="SpeakDiv2" class="mui-input-row">
					<input id="SpeakInput" type="text" class="mui-input-clear">
				</div>
				<div id="PushNotificationDiv1" class="mui-input-row mui-checkbox">
					<label id="PushNotificationLabel"></label>
					<input id="PushNotificationCheck" type="checkbox" checked="checked">
				</div>
				<div id="PushNotificationDiv2" class="mui-input-row">
					<input id="PushNotificationInput" type="text" class="mui-input-clear">
				</div>
				<div class="mui-input-row mui-checkbox">
					<label id="RunCodeLabel"></label>
					<input id="RunCodeCheck" type="checkbox">
				</div>
				<div class="mui-input-row">
					<input id="RunCodeInput" type="text" class="mui-input-clear">
				</div>
				<button id="PreviewButton" type="button" class="mui-btn mui-btn-block" onclick="task()"></button>
			</fieldset>
			<fieldset style="margin-top:20px">
				<legend id="History"></legend>
				<textarea id="HistoryText" rows="5"></textarea>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell">
						<a id="Add" href="javascript:add()" class="mui-navigate-right"></a>
					</li>
					<li class="mui-table-view-cell">
						<a id="Clear" href="javascript:document.getElementById('HistoryText').value=''" class="mui-navigate-right"></a>
					</li>
				</ul>
			</fieldset>
		</div>
		<!--[if IE]>
			<script type="text/javascript">
				window.location.href="http://t.rths.tk/web/toolbox/download.html?time="+(new Date).getTime()
			</script>
		<![endif]-->
		<!--[if !IE]><!-->
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var Hour,intervalId,Minute,Second
			if(language=="SimplifiedChinese"){
				document.title="计时器"
				document.getElementById("HourLabel").innerText="时"
				document.getElementById("MinuteLabel").innerText="分"
				document.getElementById("SecondLabel").innerText="秒"
				document.getElementsByTagName("select")[0].options.add(new Option("倒计时","Countdown"))
				document.getElementsByTagName("select")[0].options.add(new Option("秒表","Stopwatch"))
				document.getElementById("StartButton").innerText="开始"
				document.getElementById("PauseButton").innerText="暂停"
				document.getElementById("TimedTask").innerText="定时任务"
				document.getElementById("CreateMessageBoxLabel").innerText="创建消息框"
				document.getElementById("CreateMessageBoxInput").placeholder="输入消息框的内容"
				document.getElementById("CreateMessageBoxInput").value="时间到！"
				document.getElementById("OpenWebPageLabel").innerText="打开网页"
				document.getElementById("OpenWebPageInput").placeholder="输入网址"
				document.getElementById("SpeakLabel").innerText="朗读"
				document.getElementById("SpeakInput").placeholder="输入朗读的文本"
				document.getElementById("SpeakInput").value="时间到！"
				document.getElementById("PushNotificationLabel").innerText="推送通知"
				document.getElementById("PushNotificationInput").placeholder="输入通知的内容"
				document.getElementById("PushNotificationInput").value="时间到！"
				document.getElementById("RunCodeLabel").innerText="运行代码";
				document.getElementById("RunCodeInput").placeholder="输入 JS 代码";
				document.getElementById("PreviewButton").innerText="预览"
				document.getElementById("History").innerText="历史记录"
				document.getElementById("HistoryText").placeholder="还没有历史记录"
				document.getElementById("Add").innerText="添加"
				document.getElementById("Clear").innerText="清空"
			}else{
				document.title="Timer"
				document.getElementById("HourLabel").innerText="Hour"
				document.getElementById("MinuteLabel").innerText="Minute"
				document.getElementById("SecondLabel").innerText="Second"
				document.getElementsByTagName("select")[0].options.add(new Option("Countdown","Countdown"))
				document.getElementsByTagName("select")[0].options.add(new Option("Stopwatch","Stopwatch"))
				document.getElementById("StartButton").innerText="Start"
				document.getElementById("PauseButton").innerText="Pause"
				document.getElementById("TimedTask").innerText="Timed Task"
				document.getElementById("CreateMessageBoxLabel").innerText="Create Message Box"
				document.getElementById("CreateMessageBoxInput").placeholder="Enter the contents"
				document.getElementById("CreateMessageBoxInput").value="Time out!"
				document.getElementById("OpenWebPageLabel").innerText="Open Web Page"
				document.getElementById("OpenWebPageInput").placeholder="Enter the URL"
				document.getElementById("SpeakLabel").innerText="Speak"
				document.getElementById("SpeakInput").placeholder="Enter the text"
				document.getElementById("SpeakInput").value="Time out!"
				document.getElementById("PushNotificationLabel").innerText="Push Notification"
				document.getElementById("PushNotificationInput").placeholder="Enter the contents"
				document.getElementById("PushNotificationInput").value="Time out!"
				document.getElementById("RunCodeLabel").innerText="Run Code";
				document.getElementById("RunCodeInput").placeholder="Enter the JS code";
				document.getElementById("PreviewButton").innerText="Preview"
				document.getElementById("History").innerText="History"
				document.getElementById("HistoryText").placeholder="The history is empty"
				document.getElementById("Add").innerText="Add"
				document.getElementById("Clear").innerText="Clear"
			}
			document.getElementsByClassName("mui-title")[0].innerText=document.title
			if(!window.speechSynthesis){
				document.getElementById("SpeakDiv1").style.display="none"
				document.getElementById("SpeakDiv2").style.display="none"
			}
			onResize()
			window.onresize=onResize
			if(!isPlus()){
				if(window.Notification){
					Notification.requestPermission(function(){
						if(Notification.permission!="granted"){
							document.getElementById("PushNotificationDiv1").style.display="none"
							document.getElementById("PushNotificationDiv2").style.display="none"
						}
					})
				}else{
					document.getElementById("PushNotificationDiv1").style.display="none"
					document.getElementById("PushNotificationDiv2").style.display="none"
				}
			}
			if(isElectron()){
				document.addEventListener("visibilitychange",function(){
					if(document.hidden){
						window.scrollTo(0,0)
						const win=require("electron").remote.getCurrentWindow()
						win.restore()
						win.setSize(200,160)
						win.setAlwaysOnTop(true)
					}
				})
			}
			function onResize(){
				if(document.documentElement.clientWidth>500){
					document.getElementById("Time").style.fontSize="45px"
					document.getElementById("Time").style.height="90px"
				}else{
					document.getElementById("Time").style.fontSize=""
					document.getElementById("Time").style.height=""
				}
				if(isElectron()){require("electron").remote.getCurrentWindow().setAlwaysOnTop(false)}
			}
			function timeInput(){
				var timeSplit=document.getElementById("Time").value.split(":")
				if(timeSplit.length<3){
					document.getElementById("Second").value=0
					document.getElementById("Minute").value=0
					document.getElementById("Hour").value=0
				}else{
					document.getElementById("Second").value=timeSplit[2]
					document.getElementById("Minute").value=timeSplit[1]
					document.getElementById("Hour").value=timeSplit[0]
				}
			}
			function timeChanged(){
				var secondStr=addZero(document.getElementById("Second").value,2),
				minuteStr=addZero(document.getElementById("Minute").value,2),
				hourStr=addZero(document.getElementById("Hour").value,2)
				if(secondStr=="0"){secondStr="00"}
				if(minuteStr=="0"){minuteStr="00"}
				if(hourStr=="0"){hourStr="00"}
				document.getElementById("Time").value=hourStr+":"+minuteStr+":"+secondStr
			}
			function start(){
				Second=parseInt(document.getElementById("Second").value)
				Minute=parseInt(document.getElementById("Minute").value)
				Hour=parseInt(document.getElementById("Hour").value)
				if(document.getElementsByTagName("select")[0].value=="Countdown"){
					if(Hour==0&&Minute==0&&Second==0){
						if(language=="SimplifiedChinese"){mui.alert("请设置倒计时时间","计时器")}
						else{mui.alert("Please set the countdown time","Timer","OK")}
					}else{
						document.getElementsByTagName("select")[0].disabled="disabled"
						document.getElementById("StartButton").disabled="disabled"
						document.getElementById("PauseButton").disabled=""
						intervalId=setInterval(function(){countdown()},1000)
					}
				}else if(document.getElementsByTagName("select")[0].value=="Stopwatch"){
					document.getElementsByTagName("select")[0].disabled="disabled"
					document.getElementById("StartButton").disabled="disabled"
					document.getElementById("PauseButton").disabled=""
					intervalId=setInterval(function(){stopwatch()},1000)
				}
			}
			function task(){
				if(document.getElementById("RunCodeCheck").checked==true){
					try{eval(document.getElementById("RunCodeInput").value.replace(/coin|eval|task/gi,""))}
					catch(e){mui.toast(e.message)}
				}
				if(document.getElementById("CreateMessageBoxCheck").checked==true){
					if(language=="SimplifiedChinese"){mui.alert(document.getElementById("CreateMessageBoxInput").value,"计时器")}
					else{mui.alert(document.getElementById("CreateMessageBoxInput").value,"Timer","OK")}
				}
				if(document.getElementById("SpeakCheck").checked==true&&window.speechSynthesis){window.speechSynthesis.speak(new SpeechSynthesisUtterance(document.getElementById("SpeakInput").value))}
				if(document.getElementById("PushNotificationCheck").checked==true){
					if(isPlus()){plus.push.createMessage(document.getElementById("PushNotificationInput").value)}
					else if(window.Notification){
						if(Notification.permission=="granted"){
							var notification=new Notification(document.title,{
								body:document.getElementById("PushNotificationInput").value,
								icon:"unpackage/res/icons/512x512.png"
							})
							notification.onclick=function(){notification.close()}
						}
					}
				}
				if(document.getElementById("OpenWebPageCheck").checked==true){openWebPage(document.getElementById("OpenWebPageInput").value)}
			}
			function countdown(){
				if(Hour==0&&Minute==0&&Second==0){
					pause()
					task()
					return false
				}else if(Second==0){
					Second=59
					document.getElementById("Second").value=Second
					if(Minute==0){
						Minute=59
						document.getElementById("Minute").value=Minute
						Hour=Hour-1
						document.getElementById("Hour").value=Hour
					}else{
						Minute=Minute-1
						document.getElementById("Minute").value=Minute
					}
				}else{
					Second=Second-1
					document.getElementById("Second").value=Second
				}
				timeChanged()
			}
			function stopwatch(){
				if(Second==59){
					Second=0
					document.getElementById("Second").value=Second
					if(Minute==59){
						Minute=0
						document.getElementById("Minute").value=Minute
						Hour=Hour+1
						document.getElementById("Hour").value=Hour
					}else{
						Minute=Minute+1
						document.getElementById("Minute").value=Minute
					}
				}else{
					Second=Second+1
					document.getElementById("Second").value=Second
				}
				timeChanged()
			}
			function pause(){
				clearInterval(intervalId)
				document.getElementsByTagName("select")[0].disabled=""
				document.getElementById("StartButton").disabled=""
				document.getElementById("PauseButton").disabled="disabled"
			}
			function add(){
				var dateValue=new Date()
				var TimeStr=document.getElementById("Time").value+" ("+dateValue.getHours()+":"+dateValue.getMinutes()+":"+dateValue.getSeconds()+")",
				HistoryValue=document.getElementById("HistoryText").value
				if(HistoryValue==""){document.getElementById("HistoryText").value=TimeStr}
				else{document.getElementById("HistoryText").value=TimeStr+"\n"+HistoryValue}
			}
		</script>
		<!--<![endif]-->
	</body>
</html>