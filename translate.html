<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			ul{
				display:none;
			}
			.mui-btn{
				margin-bottom:15px;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<table width="100%">
				<tbody>
					<tr>
						<td width="30%">
							<div id="From"></div>
						</td>
						<td width="70%">
							<select id="FromSelect"></select>
						</td>
					</tr>
					<tr>
						<td width="30%">
							<div id="To"></div>
						</td>
						<td width="70%">
							<select id="ToSelect"></select>
						</td>
					</tr>
				</tbody>
			</table>
			<button id="ExchangeButton" type="button" class="mui-btn mui-btn-block"></button>
			<textarea id="Original"></textarea>
			<div class="btn-bg-img">
				<button id="TranslateButton" type="button" class="mui-btn mui-btn-blue mui-btn-block"></button>
			</div>
			<textarea id="Translated"></textarea>
			<ul class="menu">
				<span id="SavedText"></span>
			</ul>
		</div>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var hist=[]
			function add(text,saved){
				if((function(){
					for(var i=0;i<hist.length;i++){
						if(hist[i]==text){
							return false
						}
					}
					return true
				})()){
					hist.push(text)
					if(!document.getElementsByTagName("ul")[0].style.display){
						document.getElementsByTagName("ul")[0].style.display="block"
					}
					var newLi=document.createElement("li")
					newLi.classList.add("menu")
					newLi.innerText=text
					newLi.onclick=function(){
						scrollTo(0,0)
						document.getElementById("Original").value=this.innerText
						translateText()
					}
					if(saved){
						document.getElementById("SavedText").appendChild(newLi)
					}else{
						document.getElementsByTagName("ul")[0].appendChild(newLi)
					}
				}
			}
			function loadSavedText(e){
				if(e&&e.text){
					for(var i=0;i<e.text.length;i++){
						if(e.text[i].encrypt){
							add(decrypt(e.text[i].text,"RTH"),true)
						}else{
							add(e.text[i].text,true)
						}
					}
				}
			}
			function translateText(){
				translate(document.getElementById("Original").value,document.getElementById("FromSelect").value,document.getElementById("ToSelect").value,function(e,data){
					document.getElementById("FromSelect").value=data.from
					document.getElementById("Translated").value=e
					if(data.trans_result.length>1){
						for(var i=1;i<data.trans_result.length;i++){
							document.getElementById("Translated").value+="\n"
							document.getElementById("Translated").value+=data.trans_result[i].dst
						}
					}
					add(document.getElementById("Original").value)
				})
			}
			document.getElementById("ExchangeButton").onclick=function(){
				var from=document.getElementById("FromSelect").value
				if(from!="auto"){
					document.getElementById("FromSelect").value=document.getElementById("ToSelect").value
					document.getElementById("ToSelect").value=from
					document.getElementById("Original").value=document.getElementById("Translated").value
					document.getElementById("Translated").value=""
					if(document.getElementById("Original").value){
						translateText()
					}
				}
			}
			document.getElementById("Original").onkeydown=function(e){
				if(e.ctrlKey||e.metaKey){
					switch(e.keyCode){
						case 13:
						translateText()
					}
				}
			}
			document.getElementById("TranslateButton").onclick=translateText
			switch(language){
				case "SimplifiedChinese":
				document.title="翻译"
				document.getElementById("From").innerText="从"
				document.getElementById("FromSelect").options.add(new Option("检测语言","auto"))
				document.getElementById("To").innerText="到"
				document.getElementById("ExchangeButton").innerText="交换"
				document.getElementById("TranslateButton").innerText="翻译"
				break
				default:
				document.title="Translate"
				document.getElementById("From").innerText="From"
				document.getElementById("FromSelect").options.add(new Option("Detect Language","auto"))
				document.getElementById("To").innerText="To"
				document.getElementById("ExchangeButton").innerText="Exchange"
				document.getElementById("TranslateButton").innerText="Translate"
			}
			document.getElementsByClassName("mui-title")[0].innerText=document.title
			for(var i=0;i<langOpt.length;i++){
				document.getElementById("FromSelect").options.add(new Option(langOpt[i][0],langOpt[i][1]))
				document.getElementById("ToSelect").options.add(new Option(langOpt[i][0],langOpt[i][1]))
			}
			switch(language){
				case "SimplifiedChinese":
				document.getElementById("ToSelect").value="zh"
				break
				default:
				document.getElementById("ToSelect").value="en"
			}
			loadSavedText(JSON.parse(localStorage.getItem("SavedText")))
			if(login.username){
				getJSON("userdata/text/"+login.username+".txt",loadSavedText,null,true)
			}
		</script>
	</body>
</html>
