<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<meta name="renderer" content="webkit">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			.number{
				font-size:45px;
				text-align:center;
				line-height:60px;
				height:60px;
				-webkit-user-select:text;
				user-select:text
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<div class="number">0</div>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block" style="margin-top:20px"></button>
			<fieldset style="margin-top:20px">
				<legend id="Settings"></legend>
				<div class="mui-input-row">
					<label id="MinimumLabel"></label>
					<input id="Minimum" type="text" value="1">
				</div>
				<div class="mui-input-row">
					<label id="MaximumLabel"></label>
					<input id="Maximum" type="text" value="60">
				</div>
				<div class="mui-input-row mui-checkbox ">
					<label id="OddNumberOnlyLabel"></label>
					<input id="OddNumberOnlyCheck" name="Checkbox" type="checkbox">
				</div>
				<div class="mui-input-row mui-checkbox ">
					<label id="EvenNumberOnlyLabel"></label>
					<input id="EvenNumberOnlyCheck" name="Checkbox" type="checkbox">
				</div>
			</fieldset>
			<fieldset style="margin-top:20px">
				<legend id="History"></legend>
				<textarea id="HistoryText" rows="5"></textarea>
				<ul class="menu">
					<li id="Add" class="menu"></li>
					<li id="Clear" class="menu"></li>
				</ul>
			</fieldset>
			<fieldset style="margin-top:20px">
				<legend id="Names"></legend>
				<textarea id="NamesText" rows="5"></textarea>
				<ul class="menu">
					<li id="NamesSave" class="menu"></li>
					<li id="NamesAdd" class="menu"></li>
					<li id="NamesClear" class="menu"></li>
				</ul>
			</fieldset>
		</div>
		<script src="js/check.js"></script>
		<!--[if !IE]><!-->
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			let namesValue=localStorage.getItem("Names"),
			scrolling=true,
			multipleTimes=true,
			intervalId
			function count(){
				if(namesValue==""||namesValue==null){
					document.getElementById("Minimum").value="1"
					document.getElementById("Maximum").value="60"
				}else{
					document.getElementById("Minimum").value="0"
					document.getElementById("Maximum").value=namesValue.split("\n").length-2
				}
			}
			function random(){
				const min=parseInt(document.getElementById("Minimum").value),
				max=parseInt(document.getElementById("Maximum").value)
				const RandomNumberValue=min+Math.round(Math.random()*(max-min))
				if(document.getElementById("OddNumberOnlyCheck").checked==true&&RandomNumberValue%2==0||document.getElementById("EvenNumberOnlyCheck").checked==true&&RandomNumberValue%2!=0){
					random()
					return false
				}
				if(namesValue!=""&&namesValue!=null){
					document.getElementsByClassName("number")[0].innerText=namesValue.split("\n")[RandomNumberValue]
				}else{
					document.getElementsByClassName("number")[0].innerText=RandomNumberValue
				}
			}
			function RScrolling(){
				const min=parseInt(document.getElementById("Minimum").value),
				max=parseInt(document.getElementById("Maximum").value)
				if(min==max){
					document.getElementsByClassName("number")[0].innerText="?"
				}else{
					random()
				}
				scrolling=true
			}
			document.getElementsByTagName("button")[0].onclick=function(){
				const selected=function(){
					if(multipleTimes==false){
						namesValue=namesValue.replace(document.getElementsByClassName("number")[0].innerText+"\n","")
						count()
					}
				}
				if(scrolling==false){
					intervalId=setInterval(function(){
						RScrolling()
					},10)
					scrolling=true
				}else{
					clearInterval(intervalId)
					scrolling=false
					if(document.getElementsByClassName("number")[0].innerText=="?"){
						random()
					}
					selected()
				}
			}
			document.getElementById("OddNumberOnlyCheck").onchange=function(){
				document.getElementById("EvenNumberOnlyCheck").checked=false
			}
			document.getElementById("EvenNumberOnlyCheck").onchange=function(){
				document.getElementById("OddNumberOnlyCheck").checked=false
			}
			document.getElementById("Add").onclick=function(){
				const historyValue=document.getElementById("HistoryText").value
				if(historyValue==""){
					document.getElementById("HistoryText").value=document.getElementsByClassName("number")[0].innerText
				}else{
					document.getElementById("HistoryText").value=document.getElementsByClassName("number")[0].innerText+"\n"+historyValue
				}
			}
			document.getElementById("Clear").onclick=function(){
				document.getElementById("HistoryText").value=""
			}
			document.getElementById("NamesSave").onclick=function(){
				multipleTimes=true
				document.getElementById("NamesText").style.display=""
				namesValue=document.getElementById("NamesText").value
				const namesSplit=namesValue.split("\n")
				if(namesSplit[namesSplit.length-1]!=""){
					namesValue+="\n"
				}
				localStorage.setItem("Names",namesValue)
				count()
				window.scrollTo(0,0)
				showConfirm([
					"Do you want each name to be selected only once?",
					"您想让每个名字都只被抽到一次吗？"
				],null,function(){
					multipleTimes=false
					document.getElementById("NamesText").style.display="none"
				})
			}
			document.getElementById("NamesAdd").onclick=function(){
				multipleTimes=true
				document.getElementById("NamesText").style.display=""
				showPrompt([
					"Enter a person's name",
					"输入一个人的名字"
				],[
					"Add",
					"添加"
				],function(e){
					const namesSplit=document.getElementById("NamesText").value.split("\n")
					if(namesSplit[namesSplit.length-1]!=""){
						document.getElementById("NamesText").value+="\n"
					}
					document.getElementById("NamesText").value+=e
				})
			}
			document.getElementById("NamesClear").onclick=function(){
				document.getElementById("NamesText").value=""
				localStorage.removeItem("Names")
				namesValue=""
				multipleTimes=true
				document.getElementById("NamesText").style.display=""
				count()
			}
			switch(language){
				case "SimplifiedChinese":
					document.title="随机抽号"
					document.getElementsByTagName("button")[0].innerText="立即抽号"
					document.getElementById("Settings").innerText="设置"
					document.getElementById("MinimumLabel").innerText="最小值"
					document.getElementById("MaximumLabel").innerText="最大值"
					document.getElementById("OddNumberOnlyLabel").innerText="仅奇数"
					document.getElementById("EvenNumberOnlyLabel").innerText="仅偶数"
					document.getElementById("History").innerText="历史记录"
					document.getElementById("HistoryText").placeholder="还没有历史记录"
					document.getElementById("Add").innerText="添加"
					document.getElementById("Clear").innerText="清空"
					document.getElementById("Names").innerText="名字"
					document.getElementById("NamesText").placeholder="输入每个人的名字"
					document.getElementById("NamesSave").innerText="保存"
					document.getElementById("NamesAdd").innerText="添加"
					document.getElementById("NamesClear").innerText="清空"
					break
				default:
					document.title="Random Number"
					document.getElementsByTagName("button")[0].innerText="Select Randomly"
					document.getElementById("Settings").innerText="Settings"
					document.getElementById("MinimumLabel").innerText="Minimum"
					document.getElementById("MaximumLabel").innerText="Maximum"
					document.getElementById("OddNumberOnlyLabel").innerText="Odd Number Only"
					document.getElementById("EvenNumberOnlyLabel").innerText="Even Number Only"
					document.getElementById("History").innerText="History"
					document.getElementById("HistoryText").placeholder="The history is empty"
					document.getElementById("Add").innerText="Add"
					document.getElementById("Clear").innerText="Clear"
					document.getElementById("Names").innerText="Names"
					document.getElementById("NamesText").placeholder="Enter everyone's name"
					document.getElementById("NamesSave").innerText="Save"
					document.getElementById("NamesAdd").innerText="Add"
					document.getElementById("NamesClear").innerText="Clear"
					break
			}
			document.getElementsByClassName("mui-title")[0].innerText=document.title
			document.getElementById("NamesText").value=namesValue
			count()
			intervalId=setInterval(function(){
				RScrolling()
			},10)
		</script>
		<!--<![endif]-->
	</body>
</html>
