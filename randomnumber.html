<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			.number{
				font-size:45px;
				height:60px;
				line-height:60px;
				text-align:center;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<div class="number">0</div>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block" style="margin-top:20px"></button>
			<fieldset style="margin-top:20px">
				<legend id="Settings"></legend>
				<div class="width-limit">
					<div class="mui-input-row">
						<label id="MinimumLabel"></label>
						<input id="Minimum" type="text" value="1">
					</div>
					<div class="mui-input-row">
						<label id="MaximumLabel"></label>
						<input id="Maximum" type="text" value="60">
					</div>
					<div class="mui-input-row mui-checkbox">
						<label id="DuplicatesLabel"></label>
						<input id="DuplicatesCheck" type="checkbox" checked="checked">
					</div>
					<div class="mui-input-row mui-checkbox">
						<label id="OddNumberOnlyLabel"></label>
						<input id="OddNumberOnlyCheck" type="checkbox">
					</div>
					<div class="mui-input-row mui-checkbox">
						<label id="EvenNumberOnlyLabel"></label>
						<input id="EvenNumberOnlyCheck" type="checkbox">
					</div>
					<div class="mui-input-row mui-checkbox">
						<label id="ShowMoreLabel"></label>
						<input id="ShowMoreCheck" type="checkbox" checked="checked">
					</div>
				</div>
			</fieldset>
			<fieldset style="margin-top:20px">
				<legend id="History"></legend>
				<textarea id="HistoryText" readonly="readonly" rows="5"></textarea>
				<ul class="menu">
					<li id="Add" class="menu"></li>
					<li id="Clear" class="menu"></li>
				</ul>
			</fieldset>
			<fieldset style="margin-top:20px">
				<legend id="Names"></legend>
				<textarea id="NamesText" rows="5"></textarea>
				<ul class="menu">
					<li id="NamesSave" class="menu"></li>
					<li id="NamesAdd" class="menu"></li>
					<li id="NamesClear" class="menu"></li>
				</ul>
			</fieldset>
		</div>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var namesValue,
			nameValue,
			randomNumValue,
			scrolling=true,
			intervalId
			function add(){
				var histLength=0,
				histValue="\n"+document.getElementById("HistoryText").value
				if(document.getElementById("HistoryText").value==""){
					histValue=""
				}else{
					histLength=document.getElementById("HistoryText").value.split("\n").length
				}
				document.getElementById("HistoryText").value="["+(histLength+1)+"] #"+randomNumValue+" "+nameValue+histValue
			}
			function count(){
				if(namesValue==""||namesValue==null){
					document.getElementById("Minimum").value="1"
					document.getElementById("Maximum").value="60"
				}else{
					document.getElementById("Minimum").value="1"
					document.getElementById("Maximum").value=namesValue.split("\n").length-1
				}
			}
			function random(){
				var hide=false,
				min=parseInt(document.getElementById("Minimum").value),
				max=parseInt(document.getElementById("Maximum").value)
				nameValue=""
				randomNumValue=min+Math.round(Math.random()*(max-min))
				if(namesValue!=""&&namesValue!=null){
					nameValue=namesValue.split("\n")[randomNumValue-1]
				}
				if((function(){
					if(document.getElementById("OddNumberOnlyCheck").checked&randomNumValue%2==0||document.getElementById("EvenNumberOnlyCheck").checked&&randomNumValue%2!=0){
						return true
					}else{
						if(document.getElementById("HistoryText").value!=""&&!document.getElementById("DuplicatesCheck").checked){
							var histLength=document.getElementById("HistoryText").value.split("\n").length,
							range=max-min+1
							if(histLength<range){
								if(histLength==range-1){
									hide=true
								}
								return document.getElementById("HistoryText").value.indexOf("#"+randomNumValue+" ")!=-1
							}else if(histLength>=range){
								document.getElementById("DuplicatesCheck").checked=true
								return true
							}else{
								return false
							}
						}else{
							return false
						}
					}
				})()){
					random()
				}else{
					if(hide&&scrolling){
						document.getElementsByClassName("number")[0].innerText="?"
					}else{
						if(nameValue!=""){
							document.getElementsByClassName("number")[0].innerText=nameValue
						}else{
							document.getElementsByClassName("number")[0].innerText=randomNumValue
						}
					}
				}
			}
			function RScrolling(){
				random()
				scrolling=true
			}
			document.getElementsByTagName("button")[0].onclick=function(){
				if(scrolling==false){
					intervalId=setInterval(RScrolling,10)
					scrolling=true
				}else{
					clearInterval(intervalId)
					scrolling=false
					if(document.getElementsByClassName("number")[0].innerText=="?"){
						random()
					}
					add()
				}
			}
			document.getElementById("OddNumberOnlyCheck").onchange=function(){
				document.getElementById("EvenNumberOnlyCheck").checked=false
			}
			document.getElementById("EvenNumberOnlyCheck").onchange=function(){
				document.getElementById("OddNumberOnlyCheck").checked=false
			}
			document.getElementById("ShowMoreCheck").onchange=function(){
				var fieldset=document.getElementsByTagName("fieldset")
				if(this.checked){
					for(var i=1;i<fieldset.length;i++){
						fieldset[i].style.display=""
					}
				}else{
					for(var i=1;i<fieldset.length;i++){
						fieldset[i].style.display="none"
					}
				}
			}
			document.getElementById("Add").onclick=add
			document.getElementById("Clear").onclick=function(){
				document.getElementById("HistoryText").value=""
			}
			document.getElementById("NamesSave").onclick=function(){
				document.getElementById("NamesText").value=document.getElementById("NamesText").value.replace(/#/g,"")
				namesValue=document.getElementById("NamesText").value
				var namesSplit=namesValue.split("\n")
				if(namesSplit[namesSplit.length-1]!=""){
					namesValue+="\n"
				}
				localStorage.setItem("Names",namesValue)
				count()
			}
			document.getElementById("NamesAdd").onclick=function(){
				showPrompt([
					"Enter a person's name",
					"输入一个人的名字"
				],[
					"Add",
					"添加"
				],function(e){
					var namesSplit=document.getElementById("NamesText").value.split("\n")
					if(namesSplit[namesSplit.length-1]!=""){
						document.getElementById("NamesText").value+="\n"
					}
					document.getElementById("NamesText").value+=e
				})
			}
			document.getElementById("NamesClear").onclick=function(){
				document.getElementById("NamesText").value=""
				localStorage.removeItem("Names")
				namesValue=""
				count()
			}
			switch(language){
				case "SimplifiedChinese":
					document.title="随机抽号"
					document.getElementsByTagName("button")[0].innerText="立即抽号"
					document.getElementById("Settings").innerText="设置"
					document.getElementById("MinimumLabel").innerText="最小值"
					document.getElementById("MaximumLabel").innerText="最大值"
					document.getElementById("DuplicatesLabel").innerText="重复"
					document.getElementById("OddNumberOnlyLabel").innerText="仅奇数"
					document.getElementById("EvenNumberOnlyLabel").innerText="仅偶数"
					document.getElementById("ShowMoreLabel").innerText="显示更多"
					document.getElementById("History").innerText="历史记录"
					document.getElementById("HistoryText").placeholder="还没有历史记录"
					document.getElementById("Add").innerText="添加"
					document.getElementById("Clear").innerText="清空"
					document.getElementById("Names").innerText="名字"
					document.getElementById("NamesText").placeholder="输入每个人的名字"
					document.getElementById("NamesSave").innerText="保存"
					document.getElementById("NamesAdd").innerText="添加"
					document.getElementById("NamesClear").innerText="清空"
					break
				default:
					document.title="Random Number"
					document.getElementsByTagName("button")[0].innerText="Select Randomly"
					document.getElementById("Settings").innerText="Settings"
					document.getElementById("MinimumLabel").innerText="Minimum"
					document.getElementById("MaximumLabel").innerText="Maximum"
					document.getElementById("DuplicatesLabel").innerText="Duplicates"
					document.getElementById("OddNumberOnlyLabel").innerText="Odd Number Only"
					document.getElementById("EvenNumberOnlyLabel").innerText="Even Number Only"
					document.getElementById("ShowMoreLabel").innerText="Show More"
					document.getElementById("History").innerText="History"
					document.getElementById("HistoryText").placeholder="The history is empty"
					document.getElementById("Add").innerText="Add"
					document.getElementById("Clear").innerText="Clear"
					document.getElementById("Names").innerText="Names"
					document.getElementById("NamesText").placeholder="Enter everyone's name"
					document.getElementById("NamesSave").innerText="Save"
					document.getElementById("NamesAdd").innerText="Add"
					document.getElementById("NamesClear").innerText="Clear"
					break
			}
			document.getElementsByClassName("mui-title")[0].innerText=document.title
			if(localStorage.getItem("Names")!=null){
				namesValue=localStorage.getItem("Names")
				document.getElementById("NamesText").value=namesValue
			}
			count()
			intervalId=setInterval(function(){
				RScrolling()
			},10)
		</script>
	</body>
</html>
