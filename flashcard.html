<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<div class="mui-input-row">
				<input type="text" class="mui-input-clear">
			</div>
			<ul class="menu card">
				<li id="Pronunciation" class="menu" style="display:none"></li>
				<li id="CNDefinition" class="menu" style="display:none"></li>
				<li id="ENDefinition" class="menu" style="display:none"></li>
				<li id="Translate" class="menu" style="display:none"></li>
				<li id="Download" class="menu" style="display:none"></li>
			</ul>
		</div>
		<div style="position:fixed;width:100%;bottom:45px">
			<button id="ShowDefinition" type="button" class="mui-btn mui-btn-link mui-btn-block"></button>
		</div>
		<footer>
			<div id="Previous" style="width:50%"></div>
			<div id="Next" style="width:50%"></div>
		</footer>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var audioURL,
			progress=1,
			showDefinition,
			WordListText=localStorage.getItem("WordList"),
			WLTSplit
			var wordURL=searchURL("word",window.location.search)
			function dictChanged(){
				var dictBox
				var changeDisplay=function(alwaysShow){
					if(dictBox.innerText==""||dictBox.innerText=="undefined"){
						dictBox.style.display="none"
					}else if(showDefinition||alwaysShow){
						dictBox.style.display=""
					}
				}
				dictBox=document.getElementById("Pronunciation")
				changeDisplay(true)
				dictBox=document.getElementById("CNDefinition")
				changeDisplay(false)
				dictBox=document.getElementById("ENDefinition")
				changeDisplay(false)
				dictBox=document.getElementById("Translate")
				changeDisplay(false)
			}
			function loadTitle(){
				document.getElementsByClassName("mui-title")[0].innerText=document.title
				if(!isApp){
					document.getElementById("Download").style.display=""
				}
			}
			function loadWord(){
				if(WLTSplit[progress*2-1]==null||WLTSplit[progress*2]==null){
					return false
				}
				document.getElementsByTagName("input")[0].value=WLTSplit[progress*2-1]
				document.getElementById("CNDefinition").style.display="none"
				document.getElementById("ENDefinition").style.display="none"
				document.getElementById("ENDefinition").innerText=WLTSplit[progress*2]
				var wordWithoutSpace=WLTSplit[progress*2-1].replace(/\s/g,"").toLowerCase()
				if(localStorage.getItem(wordWithoutSpace+"_CNDef")!=null){
					document.getElementById("Pronunciation").innerText=localStorage.getItem(wordWithoutSpace+"_Pronunciation")
					audioURL=localStorage.getItem(wordWithoutSpace+"_Audio")
					document.getElementById("CNDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_CNDef")
					document.getElementById("ENDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_ENDef")
					dictChanged()
				}else if(!isOnline){
					document.getElementById("Previous").style.display="none"
					document.getElementById("Next").style.display="none"
					request("https://api.shanbay.com/bdc/search/?word="+WLTSplit[progress*2-1],function(e){
						var json=JSON.parse(e)
						if(json.msg=="SUCCESS"){
							document.getElementById("Pronunciation").innerText=json.data.pronunciation
							audioURL=json.data.audio
							document.getElementById("CNDefinition").innerText=json.data.cn_definition.defn
							document.getElementById("ENDefinition").innerText=json.data.en_definition.defn
							dictChanged()
							if(wordWithoutSpace.indexOf(" ")==-1){
								localStorage.setItem(wordWithoutSpace+"_Pronunciation",json.data.pronunciation)
								localStorage.setItem(wordWithoutSpace+"_Audio",json.data.audio)
								localStorage.setItem(wordWithoutSpace+"_CNDef",json.data.cn_definition.defn)
								localStorage.setItem(wordWithoutSpace+"_ENDef",json.data.en_definition.defn)
							}
						}
						document.getElementById("Previous").style.display=""
						document.getElementById("Next").style.display=""
					})
				}
			}
			function lookUp(word){
				switch(language){
					case "SimplifiedChinese":
						document.title="词典"
						document.getElementsByClassName("mui-title")[0].innerText="正在加载"
						break
					default:
						document.title="Dictionary"
						document.getElementsByClassName("mui-title")[0].innerText="Loading"
						break
				}
				reset()
				showDefinition=true
				document.getElementById("ShowDefinition").style.display="none"
				document.getElementsByTagName("footer")[0].style.display="none"
				document.getElementsByTagName("input")[0].value=word
				var wordWithoutSpace=word.replace(/\s/g,"").toLowerCase()
				if(localStorage.getItem(wordWithoutSpace+"_CNDef")!=null){
					loadTitle()
					document.getElementById("Pronunciation").innerText=localStorage.getItem(wordWithoutSpace+"_Pronunciation")
					audioURL=localStorage.getItem(wordWithoutSpace+"_Audio")
					document.getElementById("CNDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_CNDef")
					document.getElementById("ENDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_ENDef")
					dictChanged()
				}else if(isOnline){
					translateWord(word)
				}else{
					request("https://api.shanbay.com/bdc/search/?word="+word,function(e){
						var json=JSON.parse(e)
						if(json.msg=="SUCCESS"){
							loadTitle()
							document.getElementById("Pronunciation").innerText=json.data.pronunciation
							audioURL=json.data.audio
							document.getElementById("CNDefinition").innerText=json.data.cn_definition.defn
							document.getElementById("ENDefinition").innerText=json.data.en_definition.defn
							dictChanged()
							if(wordWithoutSpace.indexOf(" ")==-1){
								localStorage.setItem(wordWithoutSpace+"_Pronunciation",json.data.pronunciation)
								localStorage.setItem(wordWithoutSpace+"_Audio",json.data.audio)
								localStorage.setItem(wordWithoutSpace+"_CNDef",json.data.cn_definition.defn)
								localStorage.setItem(wordWithoutSpace+"_ENDef",json.data.en_definition.defn)
							}
						}else{
							translateWord(word)
						}
					})
				}
			}
			function reset(){
				document.getElementById("Pronunciation").innerText=""
				audioURL=""
				document.getElementById("CNDefinition").innerText=""
				document.getElementById("ENDefinition").innerText=""
				document.getElementById("Translate").innerText=""
				dictChanged()
			}
			function translateWord(word){
				translate(word,"auto","auto",function(e){
					loadTitle()
					document.getElementById("Translate").innerText=e.trans_result[0].dst
					dictChanged()
				})
			}
			document.getElementsByTagName("input")[0].onkeydown=function(e){
				if(e.keyCode==13&&this.value!=""){
					lookUp(this.value)
				}
			}
			document.getElementById("Pronunciation").onclick=function(){
				new Audio(audioURL).play()
			}
			document.getElementById("ENDefinition").onclick=function(){
				if(document.getElementById("Translate").innerText==""){
					translate(document.getElementById("ENDefinition").innerText,"en","zh",function(e){
						document.getElementById("Translate").innerText=e.trans_result[0].dst
						dictChanged()
					})
				}
			}
			document.getElementById("Translate").onclick=function(){
				openWebPage("http://fanyi.baidu.com/#en/zh/"+document.getElementsByTagName("input")[0].value)
			}
			document.getElementById("Download").onclick=getToolbox
			document.getElementById("ShowDefinition").onclick=function(){
				if(showDefinition){
					showDefinition=false
				}else{
					showDefinition=true
				}
				document.getElementById("ShowDefinition").style.display="none"
				dictChanged()
			}
			document.getElementById("Previous").onclick=function(){
				if(progress<=1){
					showAlert([
						"This is the first word",
						"这是第一个单词"
					])
				}else{
					showDefinition=false
					document.getElementById("ShowDefinition").style.display=""
					reset()
					progress-=1
					loadWord()
				}
			}
			document.getElementById("Next").onclick=function(){
				if(progress>=(WLTSplit.length-2)/2){
					showAlert([
						"This is the last word",
						"这是最后一个单词"
					])
				}else{
					showDefinition=false
					document.getElementById("ShowDefinition").style.display=""
					reset()
					progress+=1
					loadWord()
				}
			}
			if(WordListText!=""&&WordListText!=null){
				WLTSplit=WordListText.split("\n")
			}
			switch(language){
				case "SimplifiedChinese":
					document.getElementsByTagName("input")[0].placeholder="输入要查询的单词"
					document.getElementById("Download").innerText="下载「RTH 工具箱」查看详细内容"
					document.getElementById("ShowDefinition").innerText="显示释义"
					document.getElementById("Previous").innerText="上一个"
					document.getElementById("Next").innerText="下一个"
					break
				default:
					document.getElementsByTagName("input")[0].placeholder="Enter the word you want to look up"
					document.getElementById("Download").innerText="Download RTH Toolbox to view the details"
					document.getElementById("ShowDefinition").innerText="Show Definition"
					document.getElementById("Previous").innerText="Previous"
					document.getElementById("Next").innerText="Next"
					break
			}
			if(wordURL){
				lookUp(wordURL)
			}else{
				switch(language){
					case "SimplifiedChinese":
						document.title="学习卡"
						break
					default:
						document.title="Flash Card"
						break
				}
				document.getElementsByClassName("mui-title")[0].innerText=document.title
				loadWord()
			}
		</script>
	</body>
</html>
