<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			footer div{
				width:50%;
			}
			li.menu{
				display:none;
			}
			.show-def-btn{
				bottom:45px;
				position:fixed;
				width:100%;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<div class="mui-input-row">
				<input type="text" class="mui-input-clear">
			</div>
			<ul class="menu card">
				<li id="Pronunciation" class="menu"></li>
				<li id="CNDefinition" class="menu"></li>
				<li id="ENDefinition" class="menu"></li>
				<li id="Translate" class="menu"></li>
			</ul>
		</div>
		<div class="show-def-btn">
			<button id="ShowDefinition" type="button" class="mui-btn mui-btn-link mui-btn-block"></button>
		</div>
		<footer>
			<div id="Previous"></div>
			<div id="Next"></div>
		</footer>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var currentList,
			openedWordList=localStorage.getItem("WordList"),
			progress=1,
			showDefinition
			var wordURL=searchURL("word")
			function dictChanged(){
				var dictBox
				var changeDisplay=function(alwaysShow){
					if(dictBox.innerText==""||dictBox.innerText=="undefined"){
						dictBox.style.display=""
					}else if(showDefinition||alwaysShow){
						dictBox.style.display="block"
					}
				}
				dictBox=document.getElementById("Pronunciation")
				changeDisplay(true)
				dictBox=document.getElementById("CNDefinition")
				changeDisplay(false)
				dictBox=document.getElementById("ENDefinition")
				changeDisplay(false)
				dictBox=document.getElementById("Translate")
				if(document.getElementById("CNDefinition").style.display!=""){
					document.getElementById("Translate").style.display=""
				}else{
					changeDisplay(false)
				}
			}
			function loadWord(){
				document.getElementById("Progress").innerText=progress
				document.getElementsByTagName("input")[0].value=currentList[progress-1].word
				document.getElementById("CNDefinition").style.display="none"
				document.getElementById("ENDefinition").style.display="none"
				document.getElementById("ENDefinition").innerText=currentList[progress-1].definition
				var wordWithoutSpace=currentList[progress-1].word.replace(/\s/g,"").toLowerCase()
				if(localStorage.getItem(wordWithoutSpace+"_CNDef")!=null){
					document.getElementById("Pronunciation").innerText=localStorage.getItem(wordWithoutSpace+"_Pronunciation")
					document.getElementById("CNDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_CNDef")
					document.getElementById("ENDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_ENDef")
					dictChanged()
				}
			}
			function lookUp(word){
				document.getElementsByClassName("mui-title")[0].innerText=document.title
				reset()
				showDefinition=true
				document.getElementById("ShowDefinition").style.display="none"
				document.getElementsByTagName("footer")[0].style.display="none"
				document.getElementsByTagName("input")[0].value=word
				var wordWithoutSpace=word.replace(/\s/g,"").toLowerCase()
				if(localStorage.getItem(wordWithoutSpace+"_CNDef")!=null){
					document.getElementById("Pronunciation").innerText=localStorage.getItem(wordWithoutSpace+"_Pronunciation")
					document.getElementById("CNDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_CNDef")
					document.getElementById("ENDefinition").innerText=localStorage.getItem(wordWithoutSpace+"_ENDef")
					dictChanged()
					translateENDef()
				}else{
					translate(word,"auto","auto",function(e){
						document.getElementById("Translate").innerText=e
						dictChanged()
					})
					getJSON("http://api.shanbay.com/bdc/search/?word="+encodeURIComponent(word),function(e){
						if(e.msg=="SUCCESS"){
							document.getElementById("Pronunciation").innerText=e.data.pronunciation
							document.getElementById("CNDefinition").innerText=e.data.cn_definition.defn
							document.getElementById("ENDefinition").innerText=e.data.en_definition.defn
							dictChanged()
							if(wordWithoutSpace.indexOf(" ")==-1){
								localStorage.setItem(wordWithoutSpace+"_Pronunciation",e.data.pronunciation)
								localStorage.setItem(wordWithoutSpace+"_CNDef",e.data.cn_definition.defn)
								localStorage.setItem(wordWithoutSpace+"_ENDef",e.data.en_definition.defn)
							}
							translateENDef()
						}
					})
				}
			}
			function reset(){
				document.getElementById("Pronunciation").innerText=""
				document.getElementById("CNDefinition").innerText=""
				document.getElementById("ENDefinition").innerText=""
				document.getElementById("Translate").innerText=""
				dictChanged()
			}
			function translateENDef(){
				if(document.getElementById("ENDefinition").innerText!=""&&document.getElementById("ENDefinition").innerText!="undefined"){
					translate(document.getElementById("ENDefinition").innerText,"en","zh",function(e){
						document.getElementById("Translate").innerText=e
						document.getElementById("Translate").style.display="block"
					})
				}
			}
			document.getElementsByTagName("input")[0].onkeydown=function(e){
				if(e.keyCode==13&&this.value!=""){
					lookUp(this.value)
				}
			}
			document.getElementById("Pronunciation").onclick=function(){
				new Audio("https://media.shanbay.com/audio/us/"+document.getElementsByTagName("input")[0].value.replace(/\s/g,"_")+".mp3").play()
			}
			document.getElementById("Translate").onclick=function(){
				openWebPage("https://fanyi.baidu.com/#en/zh/"+document.getElementsByTagName("input")[0].value)
			}
			document.getElementById("ShowDefinition").onclick=function(){
				if(showDefinition){
					showDefinition=false
				}else{
					showDefinition=true
				}
				document.getElementById("ShowDefinition").style.display="none"
				dictChanged()
			}
			document.getElementById("Previous").onclick=function(){
				if(progress<=1){
					showAlert([
						"This is the first word",
						"这是第一个单词"
					])
				}else{
					showDefinition=false
					document.getElementById("ShowDefinition").style.display=""
					reset()
					progress-=1
					loadWord()
				}
			}
			document.getElementById("Next").onclick=function(){
				if(progress>=currentList.length){
					showAlert([
						"This is the last word",
						"这是最后一个单词"
					])
				}else{
					showDefinition=false
					document.getElementById("ShowDefinition").style.display=""
					reset()
					progress+=1
					loadWord()
				}
			}
			switch(language){
				case "SimplifiedChinese":
				document.title="学习卡"
				document.getElementsByTagName("input")[0].placeholder="输入要查询的单词"
				document.getElementById("ShowDefinition").innerText="显示释义"
				document.getElementById("Previous").innerText="上一个"
				document.getElementById("Next").innerText="下一个"
				break
				default:
				document.title="Flash Card"
				document.getElementsByTagName("input")[0].placeholder="Enter the word you want to look up"
				document.getElementById("ShowDefinition").innerText="Show Definition"
				document.getElementById("Previous").innerText="Previous"
				document.getElementById("Next").innerText="Next"
				break
			}
			if(openedWordList){
				currentList=JSON.parse(openedWordList).list
			}
			if(wordURL){
				document.getElementsByClassName("mui-title")[0].innerText=document.title
				lookUp(wordURL)
			}else{
				document.getElementsByClassName("mui-title")[0].innerHTML=document.title+" (<span id=\"Progress\">1</span>/"+currentList.length+")"
				loadWord()
			}
		</script>
	</body>
</html>
