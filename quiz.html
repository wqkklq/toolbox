<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<meta name="renderer" content="webkit">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<ul class="menu card">
				<li id="Show" class="menu"></li>
			</ul>
			<div style="margin-top:15px">
				<div id="EnterWordDiv" class="mui-input-row">
					<label id="WordLabel"></label>
					<input id="EnteredWord" type="text" onkeydown="if(event.keyCode==13&&this.value!=''){Next()}">
				</div>
				<div id="EnterDefinitionDiv" class="mui-input-row">
					<label id="DefinitionLabel"></label>
					<input id="EnteredDefinition" type="text" onkeydown="if(event.keyCode==13&&this.value!=''){Next()}">
				</div>
				<ul id="OptionsUl" class="menu" style="display:none">
					<li id="Option1" class="menu" onclick="OptionClicked(0)"></li>
					<li id="Option2" class="menu" onclick="OptionClicked(1)"></li>
					<li id="Option3" class="menu" onclick="OptionClicked(2)"></li>
					<li id="Option4" class="menu" onclick="OptionClicked(3)"></li>
				</ul>
				<textarea style="margin:0px;display:none" rows="10">RTH 1</textarea>
			</div>
			<button type="button" class="mui-btn mui-btn-blue mui-btn-block" style="margin-top:15px" onclick="Next()"></button>
			<ul id="OptionUl" class="menu" style="margin-top:15px">
				<li id="Restart" class="menu" onclick="Restart()"></li>
				<li id="End" class="menu" onclick="End()"></li>
				<li id="Speak" class="menu" onclick="Speak()"></li>
				<li class="menu">
					<span id="MultipleChoice"></span>
					<div id="MultipleChoiceSwitch" class="mui-switch mui-switch-blue mui-switch-mini">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li id="SpeakWordsLi" class="menu">
					<span id="SpeakWords"></span>
					<div id="SpeakWordsSwitch" class="mui-switch mui-switch-blue mui-switch-mini">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li id="SpeakDefinitionsLi" class="menu">
					<span id="SpeakDefinitions"></span>
					<div id="SpeakDefinitionsSwitch" class="mui-switch mui-switch-blue mui-switch-mini">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li class="menu">
					<span id="EnterWords"></span>
					<div id="EnterWordsSwitch" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li class="menu">
					<span id="EnterDefinitions"></span>
					<div id="EnterDefinitionsSwitch" class="mui-switch mui-switch-blue mui-switch-mini">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li class="menu">
					<span id="ShowWords"></span>
					<div id="ShowWordsSwitch" class="mui-switch mui-switch-blue mui-switch-mini">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
				<li class="menu">
					<span id="ShowDefinitions"></span>
					<div id="ShowDefinitionsSwitch" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
						<div class="mui-switch-handle" onclick="SettingsChanged=true"></div>
					</div>
				</li>
			</ul>
		</div>
		<script src="js/check.js"></script>
		<!--[if !IE]><!-->
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var CorrectWord,
			CorrectDefinition,
			OutOfOrderStr,
			CorrectInt=0,
			Progress=1,
			SettingsChanged,
			ShowAnswer=false,
			WordInt,
			WordListText=localStorage.getItem("WordList"),
			WLTSplit
			if(WordListText!=""&&WordListText!=null){WLTSplit=WordListText.split("\n")}
			if(language=="SimplifiedChinese"){
				document.title="测验"
				document.getElementById("WordLabel").innerText="单词"
				document.getElementById("EnteredWord").placeholder="在这里输入"
				document.getElementById("DefinitionLabel").innerText="释义"
				document.getElementById("EnteredDefinition").placeholder="在这里输入"
				document.getElementsByTagName("button")[0].innerText="下一题"
				document.getElementById("Restart").innerText="重新开始"
				document.getElementById("End").innerText="结束"
				document.getElementById("Speak").innerText="朗读"
				document.getElementById("MultipleChoice").innerText="选择题"
				document.getElementById("SpeakWords").innerText="朗读单词"
				document.getElementById("SpeakDefinitions").innerText="朗读释义"
				document.getElementById("EnterWords").innerText="输入单词"
				document.getElementById("EnterDefinitions").innerText="输入释义"
				document.getElementById("ShowWords").innerText="显示单词"
				document.getElementById("ShowDefinitions").innerText="显示释义"
			}else{
				document.title="Quiz"
				document.getElementById("WordLabel").innerText="Word"
				document.getElementById("EnteredWord").placeholder="Enter here"
				document.getElementById("DefinitionLabel").innerText="Definition"
				document.getElementById("EnteredDefinition").placeholder="Enter here"
				document.getElementsByTagName("button")[0].innerText="Next"
				document.getElementById("Restart").innerText="Restart"
				document.getElementById("End").innerText="End"
				document.getElementById("Speak").innerText="Speak"
				document.getElementById("MultipleChoice").innerText="Multiple Choice"
				document.getElementById("SpeakWords").innerText="Speak Words"
				document.getElementById("SpeakDefinitions").innerText="Speak Definitions"
				document.getElementById("EnterWords").innerText="Enter Words"
				document.getElementById("EnterDefinitions").innerText="Enter Definitions"
				document.getElementById("ShowWords").innerText="Show Words"
				document.getElementById("ShowDefinitions").innerText="Show Definitions"
			}
			if(!window.speechSynthesis){
				document.getElementById("Speak").style.display="none"
				document.getElementById("SpeakWordsLi").style.display="none"
				document.getElementById("SpeakDefinitionsLi").style.display="none"
			}
			Restart()
			function Restart(){
				SettingsChanged=false
				Progress=1
				OutOfOrderStr=""
				document.getElementsByTagName("textarea")[0].value="RTH 1"
				LoadQuestion()
				if(document.getElementById("MultipleChoiceSwitch").classList.contains("mui-active")){
					document.getElementById("OptionsUl").style.display=""
					document.getElementById("EnterWordDiv").style.display="none"
					document.getElementById("EnterDefinitionDiv").style.display="none"
				}else{
					document.getElementById("OptionsUl").style.display="none"
					if(document.getElementById("EnterWordsSwitch").classList.contains("mui-active")&&document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){
						document.getElementById("EnterWordDiv").style.display=""
						document.getElementById("EnterDefinitionDiv").style.display=""
					}else if(document.getElementById("EnterWordsSwitch").classList.contains("mui-active")&&!document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){
						document.getElementById("EnterWordDiv").style.display=""
						document.getElementById("EnterDefinitionDiv").style.display="none"
					}else if(!document.getElementById("EnterWordsSwitch").classList.contains("mui-active")&&document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){
						document.getElementById("EnterWordDiv").style.display="none"
						document.getElementById("EnterDefinitionDiv").style.display=""
					}else{
						document.getElementById("EnterWordDiv").style.display="none"
						document.getElementById("EnterDefinitionDiv").style.display="none"
					}
				}
				document.getElementsByTagName("button")[0].style.display=""
				document.getElementsByTagName("textarea")[0].style.display="none"
			}
			function GenerateOrder(){
				var Min=1,
				Max=(WLTSplit.length-2)/2
				var Range=Max-Min,
				Rand=Math.random()
				WordInt=Min+Math.round(Rand*Range)
				if(OutOfOrderStr.indexOf("["+WordInt+"]")!=-1){GenerateOrder()}
			}
			function LoadQuestion(){
				ShowAnswer=false
				document.getElementById("EnteredWord").value=""
				document.getElementById("EnteredDefinition").value=""
				document.getElementsByClassName("mui-title")[0].innerText=document.title+" ("+Progress+"/"+(WLTSplit.length-2)/2+")"
				GenerateOrder()
				OutOfOrderStr+="["+WordInt+"]\n"
				CorrectWord=WLTSplit[WordInt*2-1]
				CorrectDefinition=WLTSplit[WordInt*2]
				if(document.getElementById("MultipleChoiceSwitch").classList.contains("mui-active")){
					document.getElementById("Option1").innerText=""
					document.getElementById("Option2").innerText=""
					document.getElementById("Option3").innerText=""
					document.getElementById("Option4").innerText=""
					var OptionInt=0,OptionStr=""
					CorrectInt=Math.round(Math.random()*3)
					var OptionsStr="["+WordInt+"]\n"
					if(document.getElementById("EnterWordsSwitch").classList.contains("mui-active")){OptionStr=CorrectWord}
					else if(document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){OptionStr=CorrectDefinition}
					switch(CorrectInt){
						case 0:
							document.getElementById("Option1").innerText=OptionStr
							break
						case 1:
							document.getElementById("Option2").innerText=OptionStr
							break
						case 2:
							document.getElementById("Option3").innerText=OptionStr
							break
						case 3:
							document.getElementById("Option4").innerText=OptionStr
							break
						default:break
					}
					for(i=0;i<4;i++){
						GenerateOption()
						if(document.getElementById("Option1").innerText==""){document.getElementById("Option1").innerText=OptionStr}
						else if(document.getElementById("Option2").innerText==""){document.getElementById("Option2").innerText=OptionStr}
						else if(document.getElementById("Option3").innerText==""){document.getElementById("Option3").innerText=OptionStr}
						else if(document.getElementById("Option4").innerText==""){document.getElementById("Option4").innerText=OptionStr}
					}
					function GenerateOption(){
						var Range=(WLTSplit.length-2)/2,
						Rand=Math.random()
						OptionInt=Math.round(Rand*Range)
						if(document.getElementById("EnterWordsSwitch").classList.contains("mui-active")){OptionStr=WLTSplit[(OptionInt+1)*2-1]}
						else if(document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){OptionStr=WLTSplit[(OptionInt+1)*2]}
						if(OptionsStr.indexOf("["+(OptionInt+1)+"]")!=-1||OptionStr==null){GenerateOption()}
						else{OptionsStr+="["+(OptionInt+1)+"]\n"}
					}
				}
				if(document.getElementById("ShowWordsSwitch").classList.contains("mui-active")){document.getElementById("Show").innerText=CorrectWord}
				else if(document.getElementById("ShowDefinitionsSwitch").classList.contains("mui-active")){document.getElementById("Show").innerText=CorrectDefinition}
				else{
					if(language=="SimplifiedChinese"){document.getElementById("Show").innerText="没有可显示的内容"}
					else{document.getElementById("Show").innerText="There is nothing to show"}
				}
				Speak()
			}
			function Speak(){
				if(window.speechSynthesis){
					var SpeakText=""
					if(document.getElementById("SpeakWordsSwitch").classList.contains("mui-active")){SpeakText+=CorrectWord+". "}
					if(document.getElementById("SpeakDefinitionsSwitch").classList.contains("mui-active")){SpeakText+=CorrectDefinition+". "}
					window.speechSynthesis.speak(new SpeechSynthesisUtterance(SpeakText))
				}
			}
			window.onkeydown=function(e){
				switch(e.keyCode){
					case 49:
						OptionClicked(0)
						break
					case 50:
						OptionClicked(1)
						break
					case 51:
						OptionClicked(2)
						break
					case 52:
						OptionClicked(3)
						break
					default:break
				}
			}
			function OptionClicked(ClickedNum){
				if(document.getElementById("MultipleChoiceSwitch").classList.contains("mui-active")){
					if(ClickedNum==CorrectInt){
						ShowAnswer=true
						Next()
					}else{
						if(document.getElementsByTagName("textarea")[0].value.indexOf(CorrectWord)==-1){document.getElementsByTagName("textarea")[0].value+="\n"+CorrectWord+"\n"+CorrectDefinition}
						if(language=="SimplifiedChinese"){mui.alert("不是这个",document.title)}
						else{mui.alert("Not this one",document.title,"OK")}
					}
				}
			}
			function ShowReport(){
				document.getElementById("EnterWordDiv").style.display="none"
				document.getElementById("EnterDefinitionDiv").style.display="none"
				document.getElementById("OptionsUl").style.display="none"
				document.getElementsByTagName("button")[0].style.display="none"
				document.getElementsByTagName("textarea")[0].style.display=""
			}
			function Next(){
				if(SettingsChanged){
					if(language=="SimplifiedChinese"){mui.alert("单击重新开始使设置生效",document.title)}
					else{mui.alert("Click Restart to apply the settings",document.title,"OK")}
				}else{
					if(!ShowAnswer&&document.getElementById("MultipleChoiceSwitch").classList.contains("mui-active")){if(document.getElementsByTagName("textarea")[0].value.indexOf(CorrectWord)==-1){document.getElementsByTagName("textarea")[0].value+="\n"+CorrectWord+"\n"+CorrectDefinition}}
					if(!ShowAnswer&&!document.getElementById("MultipleChoiceSwitch").classList.contains("mui-active")){
						ShowAnswer=true
						if(document.getElementById("EnterWordsSwitch").classList.contains("mui-active")){
							if(document.getElementById("EnteredWord").value.replace(/(\s*$)/g,"").toLowerCase()==CorrectWord.toLowerCase()){
								if(language=="SimplifiedChinese"){document.getElementById("EnteredWord").value+="（正确）"}
								else{document.getElementById("EnteredWord").value+=" (Correct)"}
							}else{
								if(document.getElementsByTagName("textarea")[0].value.indexOf(CorrectWord)==-1){document.getElementsByTagName("textarea")[0].value+="\n"+CorrectWord+"\n"+CorrectDefinition}
								if(language=="SimplifiedChinese"){document.getElementById("EnteredWord").value+=" ≠ "+CorrectWord+"（错误）"}
								else{document.getElementById("EnteredWord").value+=" ≠ "+CorrectWord+" (Incorrect)"}
							}
						}
						if(document.getElementById("EnterDefinitionsSwitch").classList.contains("mui-active")){
							var EnteredDefWithoutSpace=document.getElementById("EnteredDefinition").value.replace(/\s+/g,""),
							CorrectDefWithoutSpace=CorrectDefinition.replace(/\s+/g,"")
							if(EnteredDefWithoutSpace==CorrectDefWithoutSpace){
								if(language=="SimplifiedChinese"){document.getElementById("EnteredDefinition").value+="（正确）"}
								else{document.getElementById("EnteredDefinition").value+=" (Correct)"}
							}else if(CorrectDefWithoutSpace.indexOf(EnteredDefWithoutSpace)!=-1||EnteredDefWithoutSpace.indexOf(CorrectDefWithoutSpace)!=-1){
								if(EnteredDefWithoutSpace==""){Incorrect()}
								else{
									var DefCorrectRate
									if(CorrectDefinition.length>EnteredDefWithoutSpace.length){DefCorrectRate=(EnteredDefWithoutSpace.length/CorrectDefinition.length)*100}
									else{DefCorrectRate=(CorrectDefinition.length/EnteredDefWithoutSpace.length)*100}
									if(DefCorrectRate<1){DefCorrectRate=1}
									else if(DefCorrectRate>99){DefCorrectRate=99}
									if(language=="SimplifiedChinese"){document.getElementById("EnteredDefinition").value+=" ≈ "+CorrectDefinition+"（"+DefCorrectRate+"% 正确）"}
									else{document.getElementById("EnteredDefinition").value+=" ≈ "+CorrectDefinition+" ("+DefCorrectRate+"% Correct)"}
								}
							}else{Incorrect()}
							function Incorrect(){
								if(document.getElementsByTagName("textarea")[0].value.indexOf(CorrectWord)==-1){document.getElementsByTagName("textarea")[0].value+="\n"+CorrectWord+"\n"+CorrectDefinition}
								if(language=="SimplifiedChinese"){document.getElementById("EnteredDefinition").value+=" ≠ "+CorrectDefinition+"（错误）"}
								else{document.getElementById("EnteredDefinition").value+=" ≠ "+CorrectDefinition+" (Incorrect)"}
							}
						}
					}else{
						if(Progress>=(WLTSplit.length-2)/2){
							ShowReport()
							var MCount=(document.getElementsByTagName("textarea")[0].value.split("\n").length-1)/2,
							WCount=(WLTSplit.length-2)/2
							var CorrectRate=100-(MCount/WCount)*100
							if(language=="SimplifiedChinese"){document.getElementById("Show").innerText="正确率："+CorrectRate+"%"}
							else{document.getElementById("Show").innerText="Correct rate: "+CorrectRate+"%"}
						}else{
							Progress+=1
							LoadQuestion()
						}
					}
				}
			}
			function End(){
				if(document.getElementsByTagName("textarea")[0].style.display!="none"){mui.back()}
				else{
					ShowReport()
					var MCount=(document.getElementsByTagName("textarea")[0].value.split("\n").length-1)/2,
					WCount=(WLTSplit.length-2)/2
					var CorrectRate1=Math.round(100-((MCount+WCount-Progress)/WCount)*100),
					CorrectRate2=Math.round(100-(MCount/Progress)*100)
					if(language=="SimplifiedChinese"){document.getElementById("Show").innerText="正确率："+CorrectRate1+"% ~ "+CorrectRate2+"%"}
					else{document.getElementById("Show").innerText="Correct rate: "+CorrectRate1+"% ~ "+CorrectRate2+"%"}
				}
			}
		</script>
		<!--<![endif]-->
	</body>
</html>
