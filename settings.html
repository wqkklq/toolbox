<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			footer div{
				width:100%;
			}
			#AccountManagement{
				display:none;
			}
			#Introduction{
				margin-top:10px;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<table width="100%">
				<tbody>
					<tr>
						<td width="30%">
							<div id="Language"></div>
						</td>
						<td width="70%">
							<select id="LanguageSelect">
								<option value="SimplifiedChinese">简体中文</option>
								<option value="English">English</option>
							</select>
						</td>
					</tr>
					<tr>
						<td width="30%">
							<div id="Theme"></div>
						</td>
						<td width="70%">
							<select id="ThemeSelect"></select>
						</td>
					</tr>
				</tbody>
			</table>
			<p id="MyEmail"></p>
			<ul class="menu">
				<li id="Login" class="menu"></li>
				<span id="AccountManagement">
					<li id="ChangePassword" class="menu"></li>
					<li id="DeleteAccount" class="menu"></li>
					<li id="LogOut" class="menu"></li>
					<li id="SwitchAccount" class="menu"></li>
				</span>
			</ul>
			<p id="Introduction"></p>
		</div>
		<footer>
			<div id="About"></div>
		</footer>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			function logOut(){
				localStorage.removeItem("Email")
				localStorage.removeItem("Password")
				localStorage.removeItem("Username")
				restart()
			}
			document.getElementById("LanguageSelect").onchange=function(){
				if(this.value!=language){
					localStorage.setItem("Language",document.getElementById("LanguageSelect").value)
					restart()
				}
			}
			document.getElementById("ThemeSelect").onchange=function(){
				if(this.value!=theme){
					localStorage.setItem("Theme",document.getElementById("ThemeSelect").value)
					restart()
				}
			}
			document.getElementById("Login").onclick=
			document.getElementById("SwitchAccount").onclick=loginDialog
			document.getElementById("ChangePassword").onclick=function(){
				showPrompt([
					"Enter your current password",
					"输入您的当前密码"
				],function(e){
					var verifyResult=verifyPassword(login.email,MD5(e))
					if(verifyResult.pass){
						showPrompt([
							"Enter a new password",
							"输入新密码"
						],function(newPassword){
							showPrompt([
								"Enter the new password again",
								"再次输入新密码"
							],function(confirmPassword){
								if(confirmPassword==newPassword){
									userInfo.users[verifyResult.index-1].password=MD5(newPassword)
									localStorage.setItem("Password",userInfo.users[verifyResult.index-1].password)
									$.post("https://rthsoftware.azurewebsites.net/userdata/upload.php",{
										"dir":"",
										"filename":"users",
										"text":JSON.stringify(userInfo)
									},function(){
										showAlert([
											"The password is changed",
											"密码已更改"
										],function(){
											location.reload()
										})
									})
								}else{
									showAlert([
										"The two passwords you entered does not match",
										"两次输入的密码不一致"
									])
								}
							},"password")
						},"password")
					}else{
						showAlert([
							"Incorrect password",
							"密码错误"
						])
					}
				},"password")
			}
			document.getElementById("DeleteAccount").onclick=function(){
				showConfirm([
					"This will delete all your data on the server",
					"此操作将在服务器上删除您的所有数据"
				],function(){
					showPrompt([
						"Enter your current password",
						"输入您的当前密码"
					],function(e){
						var verifyResult=verifyPassword(login.email,MD5(e))
						if(verifyResult.pass){
							userInfo.users.splice(verifyResult.index-1,1)
							$.post("https://rthsoftware.azurewebsites.net/userdata/upload.php",{
								"dir":"",
								"filename":"users",
								"text":JSON.stringify(userInfo)
							},function(){
								$.post("https://rthsoftware.azurewebsites.net/userdata/remove.php",{
									"username":login.username
								},logOut)
							})
						}else{
							showAlert([
								"Incorrect password",
								"密码错误"
							])
						}
					},"password")
				})
			}
			document.getElementById("LogOut").onclick=logOut
			document.getElementById("About").onclick=function(){
				openWindow("about")
			}
			switch(language){
				case "SimplifiedChinese":
				document.title="设置"
				document.getElementById("Language").innerText="语言"
				document.getElementById("Theme").innerText="主题"
				document.getElementById("ThemeSelect").options.add(new Option("自动","Automatic"))
				document.getElementById("ThemeSelect").options.add(new Option("必应","Bing"))
				document.getElementById("ThemeSelect").options.add(new Option("浅色","Light"))
				document.getElementById("ThemeSelect").options.add(new Option("深色","Dark"))
				document.getElementById("MyEmail").innerText="未登录"
				document.getElementById("Login").innerText="登录"
				document.getElementById("ChangePassword").innerText="更改密码"
				document.getElementById("DeleteAccount").innerText="删除账号"
				document.getElementById("LogOut").innerText="退出登录"
				document.getElementById("SwitchAccount").innerText="切换账号"
				document.getElementById("Introduction").innerText="登录后，您可以在 https://t.rths.tk/ 查看您保存的单词表和文本文档。"
				document.getElementById("About").innerText="关于 RTH 工具箱"
				break
				default:
				document.title="Settings"
				document.getElementById("Language").innerText="Language"
				document.getElementById("Theme").innerText="Theme"
				document.getElementById("ThemeSelect").options.add(new Option("Automatic","Automatic"))
				document.getElementById("ThemeSelect").options.add(new Option("Bing","Bing"))
				document.getElementById("ThemeSelect").options.add(new Option("Light","Light"))
				document.getElementById("ThemeSelect").options.add(new Option("Dark","Dark"))
				document.getElementById("MyEmail").innerText="Not logged in"
				document.getElementById("Login").innerText="Login"
				document.getElementById("ChangePassword").innerText="Change Password"
				document.getElementById("DeleteAccount").innerText="Delete Account"
				document.getElementById("LogOut").innerText="Log Out"
				document.getElementById("SwitchAccount").innerText="Switch Account"
				document.getElementById("Introduction").innerText="After logging in, you can view your saved word lists and text documents at https://t.rths.tk/."
				document.getElementById("About").innerText="About RTH Toolbox"
				break
			}
			document.getElementsByClassName("mui-title")[0].innerText=document.title
			document.getElementById("LanguageSelect").value=language
			document.getElementById("ThemeSelect").value=theme
			if(login.username){
				document.getElementById("MyEmail").innerText=login.email
				document.getElementById("Login").style.display="none"
				document.getElementById("AccountManagement").style.display="block"
				document.getElementById("Introduction").innerText=document.getElementById("Introduction").innerText.
				replace("After logging in, y","Y").
				replace("登录后，","")
			}
		</script>
	</body>
</html>
