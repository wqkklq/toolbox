<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/general.css">
		<style>
			footer div{
				width:100%;
			}
			.msg{
				border-radius:10px;
				line-height:25px;
				max-width:70%;
				padding:10px 15px;
				-webkit-user-select:text;
				user-select:text;
				width:fit-content;
				word-break:break-word;
			}
			.msg-bot{
				background-color:white;
				border-left:10px solid rgba(0,0,0,.25);
				color:black;
			}
			.msg-me{
				background-color:rgb(0,102,204);
				border-right:10px solid rgba(0,0,0,.25);
				color:white;
				margin:0px 0px 0px auto;
			}
			.msg-row{
				padding:5px 0px;
			}
			.mui-content{
				margin-bottom:60px;
			}
			.new-msg{
				background-color:white;
				border-radius:20px;
				bottom:30px;
				height:50px;
				left:5%;
				padding:5px 85px 5px 5px;
				position:fixed;
				width:90%;
			}
			.new-msg-background{
				background-color:rgba(239,239,244,.9);
				bottom:0px;
				box-shadow:0px -5px 10px rgb(239,239,244);
				height:80px;
				left:0px;
				position:fixed;
				width:100%;
			}
			.send input{
				background:white;
				border:solid 1px rgb(239,239,244);
				border-radius:15px;
				font-size:16px;
				height:40px;
				line-height:18px;
				padding:10px;
				width:100%;
			}
			.send-btn{
				border-radius:15px;
				bottom:0px;
				height:40px;
				margin:5px;
				position:absolute;
				right:0px;
				text-align:center;
				width:75px;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title"></header>
		<div class="mui-content">
			<div class="msg-row">
				<div id="Welcome" class="msg msg-bot"></div>
			</div>
		</div>
		<footer>
			<div id="SendMessage"></div>
		</footer>
		<script src="cordova.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/md5.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			var lastBotInfo
			function chatbotReply(botInfo){
				showLoading()
				ajax({
					"url":"http://www.tuling123.com/openapi/api",
					"data":{
						"info":botInfo,
						"key":"42cff502574d42e996841e655fecd78a"
					},
					"dataType":"json",
					"crossOrigin":true,
					"success":function(e){
						closeLoading()
						var botText=e.text,
						newDiv=document.createElement("div"),
						newChildDiv=document.createElement("div")
						newDiv.classList.add("msg-row")
						newChildDiv.classList.add("msg")
						newChildDiv.classList.add("msg-bot")
						newDiv.appendChild(newChildDiv)
						var appendMsg=function(){
							if(e.code==200000){
								newChildDiv.innerHTML+="<br><a href=\"javascript:openWebPage('"+e.url+"')\">"+e.url.split("/")[2]+"</a>"
							}
							document.getElementsByClassName("mui-content")[0].appendChild(newDiv)
							scrollTo(0,document.body.scrollHeight)
						}
						newChildDiv.innerText=botText
						appendMsg()
						switch(language){
							case "SimplifiedChinese":
							document.getElementsByClassName("mui-title")[0].innerText="康康"
							break
							default:
							translate(botText,"zh","en",function(e){
								newChildDiv.innerText+="\n"+e
								scrollTo(0,document.body.scrollHeight)
								document.getElementsByClassName("mui-title")[0].innerText="Kangkang"
							},noConnection)
						}
					},
					"error":noConnection
				})
			}
			function noConnection(){
				closeLoading()
				var newDiv=document.createElement("div"),
				newChildDiv=document.createElement("div")
				newDiv.classList.add("msg-row")
				newChildDiv.classList.add("msg")
				newChildDiv.classList.add("msg-bot")
				switch(language){
					case "SimplifiedChinese":
					newChildDiv.innerText="无法连接服务器。"
					document.getElementsByClassName("mui-title")[0].innerText="康康"
					break
					default:
					newChildDiv.innerText="Unable to connect to the server."
					document.getElementsByClassName("mui-title")[0].innerText="Kangkang"
				}
				newDiv.appendChild(newChildDiv)
				document.getElementsByClassName("mui-content")[0].appendChild(newDiv)
				scrollTo(0,document.body.scrollHeight)
			}
			document.getElementById("SendMessage").onclick=function(){
				var sendMsg=function(e){
					lastBotInfo=e
					var newMyDiv=document.createElement("div"),
					newMyChildDiv=document.createElement("div")
					newMyDiv.classList.add("msg-row")
					newMyChildDiv.classList.add("msg")
					newMyChildDiv.classList.add("msg-me")
					newMyChildDiv.innerText=document.getElementsByTagName("input")[0].value
					newMyDiv.appendChild(newMyChildDiv)
					document.getElementsByClassName("mui-content")[0].appendChild(newMyDiv)
					scrollTo(0,document.body.scrollHeight)
					switch(language){
						case "SimplifiedChinese":
						document.getElementsByClassName("mui-title")[0].innerText="对方正在输入"
						break
						default:
						document.getElementsByClassName("mui-title")[0].innerText="Typing"
					}
					if(isEnglish.test(document.getElementsByTagName("input")[0].value)){
						translate(document.getElementsByTagName("input")[0].value,"auto","zh",function(e){
							newMyChildDiv.innerText+="\n"+e
							scrollTo(0,document.body.scrollHeight)
							chatbotReply(e)
						},noConnection)
					}else{
						chatbotReply(document.getElementsByTagName("input")[0].value)
					}
				}
				showPrompt([
					"Enter the message",
					"输入消息"
				],function(e){
					sendMsg(e)
				},null,null,function(){
					showPrompt([
						"Enter the message",
						"输入消息"
					],function(e){
						sendMsg(e)
					},null,lastBotInfo)
				})
			}
			switch(language){
				case "SimplifiedChinese":
				document.title="聊天机器人"
				document.getElementsByClassName("mui-title")[0].innerText="康康"
				document.getElementById("Welcome").innerText="我们一起来聊天吧！"
				document.getElementById("SendMessage").innerText="发送消息"
				break
				default:
				document.title="Chatbot"
				document.getElementsByClassName("mui-title")[0].innerText="Kangkang"
				document.getElementById("Welcome").innerText="Let's chat!"
				document.getElementById("SendMessage").innerText="Send Message"
			}
		</script>
	</body>
</html>
