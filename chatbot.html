<!DOCTYPE html>
<html>
	<head>
		<!--Code written by Shangzhen Yang-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
		<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover">
		<meta name="theme-color" content="#0066cc">
		<meta name="renderer" content="webkit">
		<title>RTH Toolbox</title>
		<link href="unpackage/res/icons/512x512.png" rel="apple-touch-icon">
		<link href="css/mui.min.css" rel="stylesheet">
		<link href="css/general.css" rel="stylesheet">
		<style>
			.new-msg{
				background-color:#FAFAFA;
				border:solid 1px #BBBBBB;
				border-radius:20px;
				bottom:30px;
				height:52px;
				left:0px;
				margin-left:5%;
				padding:5px 85px 5px 5px;
				position:fixed;
				width:90%;
			}
			.send{height:40px}
			.send input{
				background:white;
				border:solid 1px #DDDDDD;
				border-radius:15px;
				font-size:16px;
				height:100%;
				line-height:18px;
				padding:10px;
				width:100%;
			}
			.send-right{
				bottom:0px;
				position:absolute;
				display:inline-block;
				height:50px;
				line-height:100%;
				padding:0px;
				right:0px;
				text-align:center;
				vertical-align:middle;
				width:80px;
			}
			.send-right button{
				border-radius:15px;
				height:40px;
				margin:5px 5px 0px 0px;
				width:75px;
			}
			.msg{
				border-radius:10px;
				line-height:30px;
				margin-top:10px;
				padding:10px;
				width:70%;
				user-select:text;
				-webkit-user-select:text;
			}
			.msg-bot{
				background-color:white;
				color:black;
			}
			.msg-me{
				background-color:#0066CC;
				color:white;
				margin-left:30%;
				text-align:right;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav title">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left back"></a>
			<h1 class="mui-title"></h1>
		</header>
		<div class="mui-content">
			<div id="ChatbotDiv" style="padding-bottom:87px">
				<div id="Welcome" class="msg msg-bot"></div>
				<div id="Hitokoto" class="msg msg-bot" style="display:none" onclick="hitokoto()"></div>
			</div>
		</div>
		<div class="new-msg">
			<div class="send">
				<input type="text" onkeydown="if(event.keyCode==13){send()}">
			</div>
			<div class="send-right">
				<button type="button" class="mui-btn mui-btn-blue" onclick="send()"></button>
			</div>
		</footer>
		<!--[if IE]>
			<script type="text/javascript">
				window.location.href="http://t.rths.tk/web/toolbox/download.html?time="+(new Date).getTime()
			</script>
		<![endif]-->
		<!--[if !IE]><!-->
		<script src="js/mui.min.js"></script>
		<script src="js/general.js"></script>
		<script type="text/javascript">
			if(language=="SimplifiedChinese"){
				document.title="聊天机器人"
				document.getElementsByClassName("mui-title")[0].innerText="康康"
				document.getElementById("Welcome").innerText="我们一起来聊天吧！"
				document.getElementsByTagName("button")[0].innerText="发送"
				hitokoto()
			}else{
				document.title="Chatbot"
				document.getElementsByClassName("mui-title")[0].innerText="Kangkang"
				document.getElementById("Welcome").innerText="Let's chat!"
				document.getElementsByTagName("button")[0].innerText="Send"
			}
			function hitokoto(){
				request("https://sslapi.hitokoto.cn/",function(e){
					const json=JSON.parse(e)
					document.getElementById("Hitokoto").innerText=json.hitokoto
					document.getElementById("Hitokoto").style.display=""
				})
			}
			function send(){
				if(document.getElementsByTagName("input")[0].value!=""){
					const newMyDiv=document.createElement("div")
					newMyDiv.setAttribute("class","msg msg-me")
					newMyDiv.innerText=document.getElementsByTagName("input")[0].value
					document.getElementById("ChatbotDiv").appendChild(newMyDiv)
					if(navigator.onLine){
						if(language=="SimplifiedChinese"){
							document.getElementsByClassName("mui-title")[0].innerText="对方正在输入"
							chatbotReply(document.getElementsByTagName("input")[0].value)
						}else{
							document.getElementsByClassName("mui-title")[0].innerText="Typing"
							translate(document.getElementsByTagName("input")[0].value,"auto","zh",function(e){chatbotReply(e.trans_result[0].dst)})
						}
					}else{
						const newErrorDiv=document.createElement("div")
						newErrorDiv.setAttribute("class","msg msg-bot")
						if(language=="SimplifiedChinese"){newErrorDiv.innerText="我需要连接到互联网才能和你聊天。"}
						else{newErrorDiv.innerText="I cannot chat with you without connecting to the Internet."}
						document.getElementById("ChatbotDiv").appendChild(newErrorDiv)
					}
					document.getElementsByTagName("input")[0].value=""
				}
			}
			function chatbotReply(botInfo){
				request("http://www.tuling123.com/openapi/api?key=42cff502574d42e996841e655fecd78a&info="+botInfo,function(e){
					const json=JSON.parse(e)
					const botText=json.text
					const newDiv=document.createElement("div")
					newDiv.setAttribute("class","msg msg-bot")
					if(language=="SimplifiedChinese"){
						newDiv.innerText=botText
						document.getElementById("ChatbotDiv").appendChild(newDiv)
						document.getElementsByClassName("mui-title")[0].innerText="康康"
					}else{
						translate(botText,"zh","en",function(e){
							newDiv.innerText=e.trans_result[0].dst
							document.getElementById("ChatbotDiv").appendChild(newDiv)
							document.getElementsByClassName("mui-title")[0].innerText="Kangkang"
						})
					}
				})
			}
		</script>
		<!--<![endif]-->
	</body>
</html>